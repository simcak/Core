# Tells NGINX to run its worker processes as the 'www-data' user (a low-privilege account)
user www-data;

# Number of worker processes (auto = match CPU cores)
worker_processes auto;

# File where NGINX stores its master process ID (used for reloads/restarts)
pid /run/nginx.pid;

# Where to write error logs and minimum log level
error_log /var/log/nginx/error.log;

# Event processing configuration block
events {
    # Maximum number of simultaneous connections per worker process
    worker_connections 768;
}

# HTTP server configuration block
http {
    # Use sendfile() system call for efficient file transfers (faster than read+write)
    sendfile on;

    # Send response headers and file content in single packet (optimization)
    tcp_nopush on;

    # Maximum size of hash table for MIME types (memory allocation)
    types_hash_max_size 2048;

    # Load file extension to MIME type mappings (e.g., .html = text/html)
    include /etc/nginx/mime.types;

    # Default MIME type when file type cannot be determined
    default_type application/octet-stream;

    # Where to write access logs (all incoming requests)
    access_log /var/log/nginx/access.log;

    error_log /var/log/nginx/error.log;

    # Enable gzip compression to reduce bandwidth usage
    gzip on;

    # Add "Vary: Accept-Encoding" header to tell caches compression varies by client
    gzip_vary on;

    # Compress responses for all proxy requests (any = compress all)
    gzip_proxied any;

    # Compression level 1-9 (6 = good balance of speed vs compression)
    gzip_comp_level 6;

    # Number and size of buffers for compressing response (16 buffers of 8k each)
    gzip_buffers 16 8k;

    # Minimum HTTP version required for compression (1.1 = modern standard)
    gzip_http_version 1.1;

    # File types that should be compressed (text files, JSON, JavaScript, etc.)
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

    # Include all server block configuration files from conf.d directory
    # This loads the ssl.conf file!
    include /etc/nginx/conf.d/*.conf;
}